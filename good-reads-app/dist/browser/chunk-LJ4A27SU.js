import{Ka as U,V as b,_ as S,a as h,b as w,c as M}from"./chunk-UXP3UPEQ.js";var g=function(a){return a[a.Up=1]="Up",a[a.Down=3]="Down",a[a.Right=6]="Right",a[a.Left=8]="Left",a[a.UpMirrored=2]="UpMirrored",a[a.DownMirrored=4]="DownMirrored",a[a.LeftMirrored=5]="LeftMirrored",a[a.RightMirrored=7]="RightMirrored",a[a.Default=0]="Default",a[a.NotJpeg=-1]="NotJpeg",a[a.NotDefined=-2]="NotDefined",a}(g||{}),C=class{constructor(){this.byteCount=t=>encodeURI(t).split(/%..|./).length-1}getOrientation(t){return new Promise((o,i)=>{try{let r=new FileReader;r.onload=()=>{let n=new DataView(r.result);if(!n.byteLength||n.getUint16(0,!1)!==65496)return o(g.NotDefined);let c=n.byteLength,e=2;for(;e<c;){let l=n.getUint16(e,!1);if(e+=2,l===65505){if(n.getUint32(e+=2,!1)!==1165519206)return o(g.NotJpeg);let m=n.getUint16(e+=6,!1)===18761;e+=n.getUint32(e+4,m);let u=n.getUint16(e,m);e+=2;for(let s=0;s<u;s++)if(n.getUint16(e+s*12,m)===274)return o(n.getUint16(e+s*12+8,m))}else{if((l&65280)!==65280)break;e+=n.getUint16(e,!1)}}return o(g.NotJpeg)},r.readAsArrayBuffer(t)}catch{return i(g.Default)}})}uploadFile(t,o=!0,i=!1){return new Promise((r,n)=>{let c=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),e=/iPad|iPhone|iPod/i.test(navigator.userAgent);Promise.resolve(c||e).then(l=>l?this.generateUploadInputNative(window.document,o,i):this.generateUploadInputRenderer(t,o,i)).then(l=>{let m=l?Array.from(l):[],u=m.map(p=>this.getOrientation(p)),s=m.map(p=>this.fileToDataURL(p)),d=[];Promise.all(u).then(p=>(d=p,Promise.all(s))).then(p=>{let f=p.map((v,x)=>({image:v.dataUrl,orientation:d[x],fileName:v.fileName}));r(o?f:f[0])})}).catch(l=>n(l))})}fileToDataURL(t){return new Promise((o,i)=>{let r=new FileReader;r.onload=n=>{o({dataUrl:n.target.result,fileName:t.name})};try{r.readAsDataURL(t)}catch(n){i(`ngx-image-compress - probably no file have been selected: ${n}`)}})}generateUploadInputRenderer(t,o=!0,i=!1){let r=!1;return new Promise((n,c)=>{let e=t.createElement("input");t.setStyle(e,"display","none"),t.setProperty(e,"type","file"),t.setProperty(e,"accept","image/*, .heic"),o&&t.setProperty(e,"multiple","true"),t.listen(e,"click",l=>{l.target.value=""}),t.listen(e,"change",l=>{r=!0;let m=l.target.files;n(m)}),i&&window.addEventListener("focus",()=>{setTimeout(()=>{r||c(new Error("file upload on blur - no file selected"))},300)},{once:!0}),e.click()})}generateUploadInputNative(t,o=!0,i=!1){let r=!1;return new Promise((n,c)=>{let e=t.createElement("input");e.id="upload-input"+new Date,e.style.display="none",e.setAttribute("type","file"),e.setAttribute("accept","image/*, .heic"),o&&e.setAttribute("multiple","true"),t.body.appendChild(e),e.addEventListener("change",()=>{r=!0,n(e.files),t.body.removeChild(t.getElementById(e.id))},{once:!0}),i&&window.addEventListener("focus",()=>{setTimeout(()=>{!r&&t.getElementById(e.id)&&(c(new Error("file upload on blur - no file selected")),t.body.removeChild(t.getElementById(e.id)))},300)},{once:!0}),e.click()})}compress(t,o,i,r=50,n=50,c=0,e=0){return new Promise(function(l,m){n=n/100,r=r/100;let u=new Image;u.onload=()=>{let s=i.createElement("canvas"),d=s.getContext("2d");if(!d)return m("No canvas context available");let p=u.naturalWidth,f=u.naturalHeight;if(!CSS.supports("image-orientation","from-image")&&(o===g.Right||o===g.Left)){let k=p;p=f,f=k}let v=c?c/p:1,x=e?e/f:1;r=Math.min(r,v,x),s.width=p*r,s.height=f*r;let y=Math.PI/180;CSS.supports("image-orientation","from-image")||o===g.Up?d.drawImage(u,0,0,s.width,s.height):o===g.Right?(d.save(),d.rotate(90*y),d.translate(0,-s.width),d.drawImage(u,0,0,s.height,s.width),d.restore()):o===g.Left?(d.save(),d.rotate(-90*y),d.translate(-s.width,0),d.drawImage(u,0,0,s.height,s.width),d.restore()):o===g.Down?(d.save(),d.rotate(180*y),d.translate(-s.width,-s.height),d.drawImage(u,0,0,s.width,s.height),d.restore()):d.drawImage(u,0,0,s.width,s.height);let P=t.substr(5,t.split(";")[0].length-5),B=s.toDataURL(P,n);l(B)},u.onerror=s=>m(s),u.src=t})}uploadGetImageMaxSize(t,o,i,r=!1){return M(this,null,function*(){o&&console.debug("Ngxthis - Opening upload window");let n=yield this.uploadFile(i,!1,r);return yield this.getImageMaxSize(n,t,o,i)})}getImageMaxSize(t,o,i,r){return M(this,null,function*(){let c=l=>(l/1024/1024).toFixed(2);i&&console.debug("Ngxthis - Opening upload window");let e;for(let l=0;l<10;l++){let m=this.byteCount(t.image);e=yield this.compress(t.image,t.orientation,r,50,100);let u=this.byteCount(e);if(console.debug("Ngxthis -","Compression from",c(m),"MB to",c(u),"MB"),u>=m)throw l===0?(i&&console.debug("Ngxthis -","File can't be reduced at all - returning the original",c(m),"MB large"),w(h({},t),{image:e})):(i&&console.debug("Ngxthis -","File can't be reduced more - returning the best we can, which is ",c(m),"MB large"),w(h({},t),{image:e}));if(u<o*1024*1024)return i&&console.debug("Ngxthis -","Here your file",c(u),"MB large"),w(h({},t),{image:e});if(l===9)throw i&&console.debug("Ngxthis -","File can't reach the desired size after",10,"tries. Returning file ",c(m),"MB large"),w(h({},t),{image:e});i&&console.debug("Ngxthis -","Reached",c(u),"MB large. Trying another time after",l+1,"times"),t.image=e}throw i&&console.debug("Ngxthis - Unexpected error"),{}})}},Z=(()=>{let t=class t{constructor(i){this.DOC_ORIENTATION=g,this.render=i.createRenderer(null,null),this.imageCompress=new C}byteCount(i){return this.imageCompress.byteCount(i)}getOrientation(i){return this.imageCompress.getOrientation(i)}uploadFile(){return this.imageCompress.uploadFile(this.render,!1)}uploadMultipleFiles(){return this.imageCompress.uploadFile(this.render,!0)}uploadFileOrReject(){return this.imageCompress.uploadFile(this.render,!1,!0)}uploadMultipleFilesOrReject(){return this.imageCompress.uploadFile(this.render,!0,!0)}compressFile(i,r,n=50,c=50,e=0,l=0){return this.imageCompress.compress(i,r,this.render,n,c,e,l)}uploadAndGetImageWithMaxSize(i=1,r=!1,n=!1){return this.imageCompress.uploadGetImageMaxSize(i,r,this.render,n).then(c=>c.image).catch(c=>{throw c.image})}uploadAndGetImageWithMaxSizeAndMetas(i=1,r=!1,n=!1){return this.imageCompress.uploadGetImageMaxSize(i,r,this.render,n)}getImageWithMaxSizeAndMetas(i,r=1,n=!1){return this.imageCompress.getImageMaxSize(i,r,n,this.render)}};t.\u0275fac=function(r){return new(r||t)(S(U))},t.\u0275prov=b({token:t,factory:t.\u0275fac,providedIn:"root"});let a=t;return a})();export{Z as a};
